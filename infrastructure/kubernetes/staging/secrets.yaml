# This is a template for secrets. DO NOT commit actual secrets to git.
# Use external secret management (AWS Secrets Manager, Vault, etc.)

apiVersion: v1
kind: Secret
metadata:
  name: emrtask-secrets
  namespace: emrtask-staging
type: Opaque
stringData:
  # Database credentials (should be injected via External Secrets Operator)
  DATABASE_URL: "postgresql://username:password@staging-emrtask-db.rds.amazonaws.com:5432/emrtask"
  DB_USERNAME: "emrtask_admin"
  DB_PASSWORD: "<TO_BE_INJECTED>"

  # Redis credentials
  REDIS_PASSWORD: "<TO_BE_INJECTED>"
  REDIS_AUTH_TOKEN: "<TO_BE_INJECTED>"

  # JWT secrets
  JWT_SECRET: "<TO_BE_INJECTED>"
  JWT_REFRESH_SECRET: "<TO_BE_INJECTED>"

  # Encryption keys
  ENCRYPTION_KEY: "<TO_BE_INJECTED>"

  # AWS credentials
  AWS_ACCESS_KEY_ID: "<TO_BE_INJECTED>"
  AWS_SECRET_ACCESS_KEY: "<TO_BE_INJECTED>"

  # External API keys
  EMR_API_KEY: "<TO_BE_INJECTED>"
  EPIC_CLIENT_ID: "<TO_BE_INJECTED>"
  EPIC_CLIENT_SECRET: "<TO_BE_INJECTED>"
  CERNER_API_KEY: "<TO_BE_INJECTED>"
---
# External Secrets Operator configuration
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: emrtask-staging
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets-sa
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: emrtask-external-secrets
  namespace: emrtask-staging
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: emrtask-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: staging/emrtask/database
      property: url
  - secretKey: DB_PASSWORD
    remoteRef:
      key: staging/emrtask/database
      property: password
  - secretKey: REDIS_PASSWORD
    remoteRef:
      key: staging/emrtask/redis
      property: password
  - secretKey: JWT_SECRET
    remoteRef:
      key: staging/emrtask/jwt
      property: secret
  - secretKey: ENCRYPTION_KEY
    remoteRef:
      key: staging/emrtask/encryption
      property: key
