# Istio Gateway configuration v1beta1
# External traffic entry point for EMR Task Management platform
# SECURITY FIX: TLS version upgraded to 1.3 (was 1.2)
# Certificate rotation: 90 days
# High-availability ingress with security features

apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: emr-task-gateway
  namespace: emr-task
  labels:
    app: emr-task
    component: gateway
    version: v1
  annotations:
    cert-manager.io/rotation-deadline: "90d"
    monitoring.istio.io/scrape: "true"
spec:
  selector:
    istio: ingressgateway
  servers:
    # Primary HTTPS server configuration
    - port:
        number: 443
        name: https-primary
        protocol: HTTPS
      hosts:
        - "*.emrtask.com"
      tls:
        mode: SIMPLE
        credentialName: emrtask-tls-cert
        # SECURITY FIX: Upgraded from TLS 1.2 to TLS 1.3 for enhanced security
        minProtocolVersion: TLSV1_3
        # TLS 1.3 cipher suites (TLS 1.3 uses AEAD ciphers only)
        cipherSuites:
          - TLS_AES_256_GCM_SHA384
          - TLS_CHACHA20_POLY1305_SHA256
          - TLS_AES_128_GCM_SHA256

    # HTTP redirect server configuration
    - port:
        number: 80
        name: http-redirect
        protocol: HTTP
      hosts:
        - "*.emrtask.com"
      tls:
        httpsRedirect: true