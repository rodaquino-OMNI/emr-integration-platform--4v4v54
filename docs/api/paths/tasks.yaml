tasks:
  get:
    tags:
      - Tasks
    summary: List tasks
    description: Retrieve paginated list of tasks with filtering
    operationId: listTasks
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          minimum: 1
          default: 1
        description: Page number
      - name: pageSize
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
        description: Items per page
      - name: status
        in: query
        schema:
          type: array
          items:
            $ref: '../schemas/task.yaml#/TaskStatus'
        style: form
        explode: true
        description: Filter by status
      - name: priority
        in: query
        schema:
          type: array
          items:
            $ref: '../schemas/task.yaml#/TaskPriority'
        style: form
        explode: true
        description: Filter by priority
      - name: assignedTo
        in: query
        schema:
          type: string
          format: uuid
        description: Filter by assigned user
      - name: patientId
        in: query
        schema:
          type: string
          format: uuid
        description: Filter by patient
      - name: sortBy
        in: query
        schema:
          type: string
          enum: [createdAt, updatedAt, dueDate, priority]
          default: createdAt
        description: Sort field
      - name: sortOrder
        in: query
        schema:
          type: string
          enum: [ASC, DESC]
          default: DESC
        description: Sort direction
    responses:
      '200':
        description: Tasks retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../schemas/common.yaml#/ApiResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../schemas/task.yaml#/Task'
            examples:
              success:
                summary: Successful response
                value:
                  success: true
                  data:
                    - id: 550e8400-e29b-41d4-a716-446655440000
                      title: Administer medication
                      status: IN_PROGRESS
                      priority: HIGH
                  metadata:
                    page: 1
                    pageSize: 20
                    totalCount: 45
                    totalPages: 3
                    hasNextPage: true
                    hasPreviousPage: false
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '403':
        description: Forbidden - insufficient permissions
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  post:
    tags:
      - Tasks
    summary: Create task
    description: Create a new task with EMR verification
    operationId: createTask
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/task.yaml#/TaskCreate'
          examples:
            medication:
              summary: Medication task
              value:
                title: Administer aspirin
                description: Give patient 500mg aspirin orally
                priority: HIGH
                dueDate: '2025-11-15T14:00:00Z'
                assignedTo: 7d0f4e8a-3f1c-4b2e-9a8d-1c2b3a4d5e6f
                patientId: 2c3d4e5f-6a7b-8c9d-0e1f-2a3b4c5d6e7f
                emrData:
                  system: EPIC
                  patientId: PAT-123456
                  resourceType: Task
                  data: {}
                  lastUpdated: '2025-11-15T13:00:00Z'
                  version: '1.0.0'
                  validation:
                    isValid: true
                    errors: []
                    warnings: []
                    lastValidated: '2025-11-15T13:00:00Z'
                verificationTimeout: '2025-11-15T14:30:00Z'
    responses:
      '201':
        description: Task created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../schemas/common.yaml#/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../schemas/task.yaml#/Task'
      '400':
        description: Invalid input
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

taskById:
  get:
    tags:
      - Tasks
    summary: Get task by ID
    description: Retrieve a specific task by its ID
    operationId: getTaskById
    parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Task ID
    responses:
      '200':
        description: Task retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../schemas/common.yaml#/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../schemas/task.yaml#/Task'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  patch:
    tags:
      - Tasks
    summary: Update task
    description: Partially update a task
    operationId: updateTask
    parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/task.yaml#/TaskUpdate'
    responses:
      '200':
        description: Task updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../schemas/common.yaml#/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../schemas/task.yaml#/Task'
      '400':
        description: Invalid input
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '409':
        description: Conflict - CRDT merge conflict
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  delete:
    tags:
      - Tasks
    summary: Delete task
    description: Delete a task (soft delete with audit trail)
    operationId: deleteTask
    parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Task ID
    responses:
      '204':
        description: Task deleted successfully
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

verifyTask:
  post:
    tags:
      - Tasks
    summary: Verify task
    description: Verify task using barcode scan and EMR data
    operationId: verifyTask
    parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - barcodeData
              - verifiedBy
            properties:
              barcodeData:
                type: string
                description: Scanned barcode from patient wristband
                example: PAT-123456-DOE-JOHN
              verifiedBy:
                type: string
                format: uuid
                description: Healthcare worker performing verification
                example: 7d0f4e8a-3f1c-4b2e-9a8d-1c2b3a4d5e6f
    responses:
      '200':
        description: Task verified successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../schemas/common.yaml#/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../schemas/task.yaml#/TaskVerification'
      '400':
        description: Verification failed
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

syncTask:
  post:
    tags:
      - Tasks
    summary: Sync task
    description: Force sync task with CRDT conflict resolution
    operationId: syncTask
    parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - vectorClock
            properties:
              vectorClock:
                $ref: '../schemas/common.yaml#/VectorClock'
    responses:
      '200':
        description: Task synced successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../schemas/common.yaml#/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../schemas/task.yaml#/Task'
      '409':
        description: Sync conflict
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
